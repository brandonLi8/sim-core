// Copyright Â© 2019 Brandon Li. All rights reserved.

// Minified distribution version - sim-core 0.0.0-dev.18 - MIT.
define(require=>{"use strict";const e=require("SIM_CORE/util/assert"),n=require("SIM_CORE/core-internal/Display"),i=require("SIM_CORE/core-internal/FPSCounter"),t=require("SIM_CORE/core-internal/Loader"),o=require("SIM_CORE/util/QueryParameters"),a=require("SIM_CORE/util/Util"),r=require("SIM_CORE/core-internal/NavigationBar"),s=require("SIM_CORE/Screen"),d=JSON.parse(require("text!REPOSITORY/package.json")),l=o.retrieve({ea:{type:"flag"},fps:{type:"flag"},version:{type:"flag"},dev:{type:"flag"}});return class{constructor(o,w){e(o instanceof s,`invalid screen: ${o}`),e(!w||Object.getPrototypeOf(w)===Object.prototype,`invalid options: ${w}`),w={name:d.name?a.toTitleCase(d.name):"",...w},window.isMobile=(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent||navigator.vendor||window.opera))(),window.addEventListener("pageshow",(function(e){e.persisted&&window.location.reload()})),l.version&&console.log(`${w.name}: v${d.version}`),l.ea&&e.enableAssertions();const c=new n,p=new t;if(c.addChild(p),l.fps){const e=new i;e.start(),c.addChild(e)}const v=new r(w.name);c.addChild(v),c.addChild(o),o.initializeModelAndView(),l.dev&&o._view.enableDevBorder(),window.onresize=()=>{const e=window.innerHeight,n=window.innerWidth;v.layout(n,e);const i=e-parseFloat(v.style.height);o.style.height=`${i}px`,o._view.layout(n,i)},window.onresize();let u=new Date;const O=()=>{const e=new Date,n=a.convertFrom(e-u,a.MILLI);u=e,o._model.step&&o._model.step(n),window.requestAnimationFrame(O),window.onresize()};window.requestAnimationFrame(O),window.isMobile&&document.addEventListener("touchmove",e=>{1!==e.scale&&e.preventDefault()},{passive:!1})}}});