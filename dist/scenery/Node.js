// Copyright Â© 2019 Brandon Li. All rights reserved.

// Minified distribution version - sim-core 0.0.0-dev.18 - MIT.
define(require=>{"use strict";const t=require("SIM_CORE/util/assert"),e=require("SIM_CORE/core-internal/DOMObject"),s=require("SIM_CORE/util/Vector");class i extends e{constructor(e){t(!e||Object.getPrototypeOf(e)===Object.prototype,`Extra prototype on Options: ${e}`);const s={width:null,height:null,top:null,left:null,center:null,style:{position:"absolute"},mouseover:null,mouseout:null,mousedown:null,mouseup:null};(e={...s,...e}).style={...s.style,...e.style},super(e),this._width=e.width,this._height=e.height,this._top=e.top,this._left=e.left,this._center=e.center,this.scale=null,e.mouseover&&(this.mouseover=e.mouseover),e.mouseout&&(this.mouseout=e.mouseout),e.mousedown&&(this.mousedown=e.mousedown),e.mouseup&&(this.mouseup=e.mouseup)}getWidth(){return this._width||this.style.width}get width(){return this.getWidth()}getHeight(){return this._height||this.style.height}get height(){return this.getHeight()}getTop(){return this._top||this.style.top}get top(){return this.getTop()}getLeft(){return this._left||this.style.left}get left(){return this.getLeft()}getCenter(){return this._center||this.style.center}get center(){return this.getCenter()}set mouseover(t){this._element.addEventListener("mouseover",e=>{e.stopPropagation(),e.preventDefault(),t()})}set mouseout(t){this._element.addEventListener("mouseout",e=>{e.stopPropagation(),e.preventDefault(),t()})}set mousedown(t){this._element.addEventListener(window.isMobile?"touchstart":"mousedown",e=>{e.stopPropagation(),e.preventDefault();const i=this.element.getBoundingClientRect(),o=this.getEventLocation(e),n=new s(i.x,i.y),u=o.copy().subtract(n).copy().divide(this.scale),h=o.copy().divide(this.scale);t(u,h)})}set mouseup(t){this._element.addEventListener(window.isMobile?"touchend":"mouseup",e=>{e.stopPropagation(),e.preventDefault(),t()})}getEventLocation(t){return new s(void 0!==t.clientX?t.clientX:t.touches[0].clientX,void 0!==t.clientY?t.clientY:t.touches[0].clientY)}drag(t,e,i){let o;this._element.addEventListener(window.isMobile?"touchstart":"mousedown",e=>{(e=e||window.event).preventDefault();const i=this.element.getBoundingClientRect(),n=new s(i.x,i.y);o=this.getEventLocation(e).subtract(n).divide(this.scale),t(),document.addEventListener(window.isMobile?"touchend":"mouseup",h),document.addEventListener(window.isMobile?"touchmove":"mousemove",u)});let n=null;const u=t=>{(t=t||window.event).preventDefault(),n||setTimeout(()=>{const i=this.element.getBoundingClientRect(),u=new s(i.x,i.y),h=this.getEventLocation(t).subtract(u).divide(this.scale).subtract(o);e(h),n=null},10),n=t};function h(){document.removeEventListener(window.isMobile?"touchend":"mouseup",h),document.removeEventListener(window.isMobile?"touchmove":"mousemove",u),i()}}layout(t){this.style.width=`${t*this._width}px`,this.style.height=`${t*this._height}px`,this.style.top=`${t*this._top}px`,this.style.left=`${t*this._left}px`,this.center&&(this.style.top=`${t*(this._center.y-this.height/2)}px`,this.style.left=`${t*(this._center.x-this.width/2)}px`),this.scale=t}addChild(e){return t(e instanceof i,`invalid child: ${e}`),super.addChild(e)}}return i});